{% extends "auctions/layout.html" %}
{% block title %} | Current Auctions{% endblock %}
{% block heading %}Full Description{% endblock %}
{% block crumbs %}
  <div class="container">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
  </div>
{% endblock %}

{% block body %}
  
<!-- ======= Blog Single Section ======= -->
<section id="blog" class="blog">
  {% if user.is_authenticated and listing.is_active %}
    <div class="container" data-aos="fade-up">

      <div class="row">

        <div class="col-lg-12 entries">

          <article class="entry entry-single">

            <div class="entry-img">
                <img src="{{ listing.image_url }}" alt="{{ listing.title }}" height="400px" class="img-fluid">
            </div>

            <h2 class="entry-title">
              <a href="#">{{ listing.title }}</a>
            </h2>

            <div class="entry-meta">
              <ul>
                <li class="d-flex align-items-center"><i class="bi bi-person" style="color:#008080;"></i> <a href="#">{{ listing.owner }}</a></li>
                <li class="d-flex align-items-center"><i class="bi bi-currency-dollar" style="color:#008080;"></i> <a href="#"><time datetime="2020-01-01">{{ listing.starting_bid.bid }}</time></a></li>
                <li class="d-flex align-items-center">
                  <i class="bi bi-heart{% if check_listing_in_watchlist %}{% else %}-fill{% endif %}" style="color:#008080;"></i>
                  {% if check_listing_in_watchlist %}
                    <form action="{% url 'remove_watchlist' id=listing.id %}" method="POST" style="display:inline;">
                      {% csrf_token %}
                      <a href="#" onclick="this.closest('form').submit(); return false;">Remove from Watchlist</a>
                    </form>
                  {% else %}
                    <form action="{% url 'add_watchlist' id=listing.id %}" method="POST" style="display:inline;">
                      {% csrf_token %}
                      <a href="#" onclick="this.closest('form').submit(); return false;">Add to Watchlist</a>
                    </form>
                  {% endif %}
                </li>
              </ul>
            </div>

            <div class="entry-content">
              <p>{{ listing.description }}</p>
            </div>

            <div class="entry-footer d-flex align-items-center">
              <div class="footer-section d-flex align-items-center me-3">
                <i class="bi bi-folder fs-5 me-2"></i>
                {% if is_owner %}
                  <form action="{% url 'close_auction' id=listing.id %}" method="POST" class="mb-0">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm">Close Auction</button>
                  </form>
                {% endif %}
              </div>
            
              <div class="footer-section d-flex align-items-center">
                <i class="bi bi-tags fs-5 me-2"></i>
                {% if user.is_authenticated %}
                  <form action="{% url 'add_bid' id=listing.id %}" method="POST" class="d-flex align-items-center mb-0">
                    {% csrf_token %}
                    <input type="number" placeholder="Add New Bid" min="0" name="starting_bid" class="form-control form-control-sm me-2" style="width: 120px;">
                    <button class="btn btn-primary btn-sm" type="submit" style="color: #40E0D0;">Submit Bid</button>
                  </form>
                {% endif %}
              </div>
            </div>
            

          </article><!-- End blog entry -->

          <div class="blog-comments">

            <h4 class="comments-count">Comments</h4>

            <div id="comment-1" class="comment">
              <div class="d-flex">
                {% for comment in all_comments %}
                  <div>
                    <h5><a href="">{{ comment.author }}</a> <a href="#" class="reply"><i class="bi bi-reply-fill"></i> Reply</a></h5>
                    <p>{{ comment.message }}</p>
                  </div>
                {% empty %}
                  <p>No comments yet.</p>
                {% endfor %}
              </div>
            </div><!-- End comment #1 -->

            <div class="reply-form">
              <h4>Leave a Comment</h4>
              {% if user.is_authenticated %}
                <form action="{% url 'add_comment' id=listing.id %}" method="POST">
                  {% csrf_token %}
                  <div class="row">
                    <div class="col form-group">
                      <textarea name="comment" class="form-control" placeholder="Your Comment*"></textarea>
                    </div>
                  </div>
                  <button type="submit" class="btn btn-teal">Post Comment</button>
                </form>
              {% endif %}
            </div>

          </div><!-- End blog comments -->

        </div><!-- End blog entries list -->

      </div>

    </div>
  {% endif %}
</section><!-- End Blog Single Section -->

{% endblock %}
